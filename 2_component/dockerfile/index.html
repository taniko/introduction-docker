



<!doctype html>
<html lang="ja" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="クリップボードへコピー">
      
        <meta name="lang:clipboard.copied" content="コピーしました">
      
        <meta name="lang:search.language" content="ja">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="何も見つかりませんでした">
      
        <meta name="lang:search.result.one" content="1件見つかりました">
      
        <meta name="lang:search.result.other" content="#件見つかりました">
      
        <meta name="lang:search.tokenizer" content="[\s\-　、。，．]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.1.1">
    
    
      
        <title>dockerfile - 入門 Docker</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.3020aac5.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.224b79ff.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
      <script src="../../assets/javascripts/modernizr.01ccdecf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../assets/custom.css">
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-136697307-1", "y-ohgi.com")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#docker-image" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="入門 Docker" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              入門 Docker
            </span>
            <span class="md-header-nav__topic">
              dockerfile
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="検索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            検索キーワードを入力してください
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="入門 Docker" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    入門 Docker
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      はじめに
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        はじめに
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../1_introduction/docker/" title="Dockerとは" class="md-nav__link">
      Dockerとは
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../1_introduction/vm-docker/" title="VMとDocker" class="md-nav__link">
      VMとDocker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../1_introduction/hello-docker/" title="Hello Docker !" class="md-nav__link">
      Hello Docker !
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      コンポーネント
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        コンポーネント
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../image/" title="image" class="md-nav__link">
      image
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        dockerfile
      </label>
    
    <a href="./" title="dockerfile" class="md-nav__link md-nav__link--active">
      dockerfile
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">目次</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#docker-image" title="Docker Image" class="md-nav__link">
    Docker Image
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dockerfile" title="Dockerfile" class="md-nav__link">
    Dockerfile
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dockerfile_1" title="Dockerfileを記述してみる" class="md-nav__link">
    Dockerfileを記述してみる
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" title="1. 環境の用意" class="md-nav__link">
    1. 環境の用意
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-dockerfile" title="2. Dockerfile の編集" class="md-nav__link">
    2. Dockerfile の編集
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-docker-image" title="3. Docker Image のビルド&amp;実行" class="md-nav__link">
    3. Docker Image のビルド&amp;実行
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docker-hub" title="Docker Hub へアップロード" class="md-nav__link">
    Docker Hub へアップロード
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-docker-hub" title="1. Docker Hubへログイン" class="md-nav__link">
    1. Docker Hubへログイン
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-docker-image" title="2. Docker Image の命名" class="md-nav__link">
    2. Docker Image の命名
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-docker-image_1" title="3. Docker Imageのアップロード" class="md-nav__link">
    3. Docker Imageのアップロード
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-docker-hub" title="4. Docker Hub の確認" class="md-nav__link">
    4. Docker Hub の確認
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-docker-hub-docker-image" title="5. Docker Hub にアップロードしたDocker Imageの実行" class="md-nav__link">
    5. Docker Hub にアップロードしたDocker Imageの実行
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dsl" title="DSL" class="md-nav__link">
    DSL
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" title="コマンド" class="md-nav__link">
    コマンド
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" title="基本的なコマンド" class="md-nav__link">
    基本的なコマンド
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#from" title="FROM" class="md-nav__link">
    FROM
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#env" title="ENV" class="md-nav__link">
    ENV
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workdir" title="WORKDIR" class="md-nav__link">
    WORKDIR
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#copy" title="COPY" class="md-nav__link">
    COPY
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run" title="RUN" class="md-nav__link">
    RUN
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user" title="USER" class="md-nav__link">
    USER
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cmd" title="CMD" class="md-nav__link">
    CMD
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" title="よく使用されるコマンド" class="md-nav__link">
    よく使用されるコマンド
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#expose" title="EXPOSE" class="md-nav__link">
    EXPOSE
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#volume" title="VOLUME" class="md-nav__link">
    VOLUME
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#args" title="ARGS" class="md-nav__link">
    ARGS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add" title="ADD" class="md-nav__link">
    ADD
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#entrypoint" title="ENTRYPOINT" class="md-nav__link">
    ENTRYPOINT
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" title="まとめ" class="md-nav__link">
    まとめ
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../container/" title="container" class="md-nav__link">
      container
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../network/" title="network" class="md-nav__link">
      network
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../volume/" title="volume" class="md-nav__link">
      volume
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      プロダクションでの活用
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        プロダクションでの活用
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../3_production/design/" title="設計" class="md-nav__link">
      設計
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../3_production/security/" title="セキュリティ" class="md-nav__link">
      セキュリティ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../3_production/debug/" title="デバッグ" class="md-nav__link">
      デバッグ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../3_production/image/" title="イメージの仕組み" class="md-nav__link">
      イメージの仕組み
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../3_production/dockerfile/" title="Dockerfileのベストプラクティス" class="md-nav__link">
      Dockerfileのベストプラクティス
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../3_production/orchestration/" title="オーケストレーションツール" class="md-nav__link">
      オーケストレーションツール
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../3_production/docker-compose/" title="docker-compose" class="md-nav__link">
      docker-compose
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../3_production/introduction/" title="プロダクションへの導入" class="md-nav__link">
      プロダクションへの導入
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Tips
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Tips
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../4_tips/tools/" title="tools" class="md-nav__link">
      tools
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../4_tips/docker-compose/" title="docker-compose" class="md-nav__link">
      docker-compose
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">目次</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#docker-image" title="Docker Image" class="md-nav__link">
    Docker Image
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dockerfile" title="Dockerfile" class="md-nav__link">
    Dockerfile
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dockerfile_1" title="Dockerfileを記述してみる" class="md-nav__link">
    Dockerfileを記述してみる
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" title="1. 環境の用意" class="md-nav__link">
    1. 環境の用意
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-dockerfile" title="2. Dockerfile の編集" class="md-nav__link">
    2. Dockerfile の編集
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-docker-image" title="3. Docker Image のビルド&amp;実行" class="md-nav__link">
    3. Docker Image のビルド&amp;実行
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docker-hub" title="Docker Hub へアップロード" class="md-nav__link">
    Docker Hub へアップロード
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-docker-hub" title="1. Docker Hubへログイン" class="md-nav__link">
    1. Docker Hubへログイン
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-docker-image" title="2. Docker Image の命名" class="md-nav__link">
    2. Docker Image の命名
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-docker-image_1" title="3. Docker Imageのアップロード" class="md-nav__link">
    3. Docker Imageのアップロード
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-docker-hub" title="4. Docker Hub の確認" class="md-nav__link">
    4. Docker Hub の確認
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-docker-hub-docker-image" title="5. Docker Hub にアップロードしたDocker Imageの実行" class="md-nav__link">
    5. Docker Hub にアップロードしたDocker Imageの実行
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dsl" title="DSL" class="md-nav__link">
    DSL
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" title="コマンド" class="md-nav__link">
    コマンド
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" title="基本的なコマンド" class="md-nav__link">
    基本的なコマンド
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#from" title="FROM" class="md-nav__link">
    FROM
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#env" title="ENV" class="md-nav__link">
    ENV
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workdir" title="WORKDIR" class="md-nav__link">
    WORKDIR
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#copy" title="COPY" class="md-nav__link">
    COPY
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run" title="RUN" class="md-nav__link">
    RUN
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user" title="USER" class="md-nav__link">
    USER
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cmd" title="CMD" class="md-nav__link">
    CMD
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" title="よく使用されるコマンド" class="md-nav__link">
    よく使用されるコマンド
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#expose" title="EXPOSE" class="md-nav__link">
    EXPOSE
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#volume" title="VOLUME" class="md-nav__link">
    VOLUME
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#args" title="ARGS" class="md-nav__link">
    ARGS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add" title="ADD" class="md-nav__link">
    ADD
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#entrypoint" title="ENTRYPOINT" class="md-nav__link">
    ENTRYPOINT
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" title="まとめ" class="md-nav__link">
    まとめ
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>dockerfile</h1>
                
                <h2 id="docker-image">Docker Image<a class="headerlink" href="#docker-image" title="Permanent link">&para;</a></h2>
<p>Docker Image が特定の環境のスナップショットということがわかりました。<br />
次にDocker Image を自分で作成する方法を見ていきましょう。</p>
<div class="admonition このドキュメントについて">
<p class="admonition-title">このドキュメントについて</p>
<p>Docker Image を作るための方法は複数ありますが、このドキュメントは <strong>「プロダクションへDockerを導入するための知識をハンズオン形式で最短経路で学ぶ」</strong> ということを目標にしています。<br />
そのため、現在デファクトスタンダードである <code>Dockerfile</code> のみ取り扱います。<br />
興味がある方は調べてみると良いですが、Dockerfile以外は基本的に使用されません。</p>
</div>
<h2 id="dockerfile">Dockerfile<a class="headerlink" href="#dockerfile" title="Permanent link">&para;</a></h2>
<p>Docker Image は <code>Dockerfile</code> というファイルを記述し、そのファイルを元にビルドすることでスナップショットの作成ができます。  </p>
<p>試しに <code>Dockerfile</code> を記述してDocker Image を作成してみましょう。</p>
<h3 id="dockerfile_1">Dockerfileを記述してみる<a class="headerlink" href="#dockerfile_1" title="Permanent link">&para;</a></h3>
<p>まずは <code>echo hello!</code> を実行するDocker Image を作ってみましょう。</p>
<h4 id="1">1. 環境の用意<a class="headerlink" href="#1" title="Permanent link">&para;</a></h4>
<p>ディレクトリを作成してviで <code>Dockerfile</code> へテキスト入力の開始をします。</p>
<div class="codehilite"><pre><span></span>$ cd ~
$ mkdir -p docker/ubuntu
$ cd docker/ubuntu
$ echo &quot;hello docker !&quot; &gt; hello.txt
$ vi Dockerfile
</pre></div>


<h4 id="2-dockerfile">2. <code>Dockerfile</code> の編集<a class="headerlink" href="#2-dockerfile" title="Permanent link">&para;</a></h4>
<p>Dockerfileは独自のDSLで記述します。<br />
DSLは後ほど解説しますが、以下のDockerfileは「 <code>ubuntu</code> というDocker Imageをもとに、ホストの <code>hello.txt</code> をコンテナの <code>/tmp/hello.txt</code> へコピーして、 <code>cat /tmp/hello.txt</code> コマンドを実行」という意味になります。</p>
<div class="codehilite"><pre><span></span><span class="k">FROM</span><span class="s"> ubuntu</span>

<span class="k">COPY</span> hello.txt /tmp/hello.txt

<span class="k">CMD</span> <span class="p">[</span><span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="s2">&quot;/tmp/hello.txt&quot;</span><span class="p">]</span>
</pre></div>


<h4 id="3-docker-image">3. Docker Image のビルド&amp;実行<a class="headerlink" href="#3-docker-image" title="Permanent link">&para;</a></h4>
<p><code>docker build</code> コマンドで <code>Dockerfile</code> からDocker Image を作成します。<br />
<code>-t hello</code> オプションは「Docker Imageを <code>hello</code> という名前にする」という意味です。<br />
<code>.</code> はdocker build 実行時のコンテキストの指定です。 <code>.</code> は <code>COPY</code> コマンドを実行する際にどのディレクトリを起点とするかを指定します。</p>
<div class="codehilite"><pre><span></span>$ docker build -t hello .
</pre></div>


<p>Docker Image がビルドできたか確認してみましょう。<br />
<code>docker images</code> で現在ローカルに存在するDocker Image の一覧を確認することができます。</p>
<div class="codehilite"><pre><span></span>$ docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
hello               latest              59e1a587fe86        13 seconds ago      88.9MB
ubuntu              latest              94e814e2efa8        6 days ago          88.9MB
node                latest              9ff38e3a6d9d        10 days ago         904MB
</pre></div>


<p><code>docker run image</code> で実行してみましょう。<br />
<code>CMD</code> で指定した <code>cat /tmp/hello.txt</code> が実行され、"hello docker !"と表示されるはずです。</p>
<div class="codehilite"><pre><span></span>$ docker run hello
hello docker !
</pre></div>


<h2 id="docker-hub">Docker Hub へアップロード<a class="headerlink" href="#docker-hub" title="Permanent link">&para;</a></h2>
<p>ローカルで開発したイメージをステージングや本番環境で動かすにはDockerレジストリにアップロードする必要があります。<br />
DockerレジストリはDocker Image を保存するための場所で、Docker版のGitHubのようなものです。<br />
Docker公式が提供しているDockerHubへ先ほど作成した <code>hello</code> イメージをアップロードしましょう。</p>
<div class="admonition クラウドの場合">
<p class="admonition-title">クラウドの場合</p>
<p>AWSの場合"Elastic Container Registry"が、GCPの場合"Google Container Registry" というDockerレジストリサービスが存在します。<br />
クラウド上に本番環境を構築する場合は構築するクラウドで提供されているDockerレジストリサービスを使うのが良いでしょう。</p>
</div>
<h3 id="1-docker-hub">1. Docker Hubへログイン<a class="headerlink" href="#1-docker-hub" title="Permanent link">&para;</a></h3>
<p><code>docker login</code> コマンドでDocker Hub へログインします。<br />
まだDockerHubの登録が済んでいない場合は <a href="https://hub.docker.com/">https://hub.docker.com/</a> にてアカウントの登録をしましょう。</p>
<div class="codehilite"><pre><span></span>$ docker login
Login with your Docker ID to push and pull images from Docker Hub. If you don&#39;t have a Docker ID, head over to https://hub.docker.com to
create one.
Username: &lt;YOUR USER NAME&gt;
Password: &lt;YOUR PASSWORD&gt;
WARNING! Your password will be stored unencrypted in /root/.docker/config.json.
Configure a credential helper to remove this warning. See
https://docs.docker.com/engine/reference/commandline/login/#credentials-store

Login Succeeded
</pre></div>


<h3 id="2-docker-image">2. Docker Image の命名<a class="headerlink" href="#2-docker-image" title="Permanent link">&para;</a></h3>
<p>Docker Hub にアップロードするためにはDocker Hub のDocker Image の命名規則に則る必要があります。<br />
ユーザーのオリジナルイメージは <code>&lt;USER NAME&gt;/&lt;IMAGE NAME&gt;:&lt;TAG&gt;</code> という命名にします。( <code>:&lt;TAG&gt;</code> は省略可能で、省略すると <code>:latest</code> と命名されます)</p>
<p>まずは <code>docker tag</code> コマンドで命名しましょう。 <code>&lt;USER NAME&gt;</code> は自分のユーザー名を入力してください。  </p>
<div class="codehilite"><pre><span></span>$ docker tag hello &lt;USER NAME&gt;/hello
</pre></div>


<p>命名できたかの確認をしましょう。  </p>
<div class="codehilite"><pre><span></span>$ docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
hello               latest              59e1a587fe86        19 minutes ago      88.9MB
&lt;USER NAME&gt;/hello   latest              59e1a587fe86        19 minutes ago      88.9MB
ubuntu              latest              94e814e2efa8        6 days ago          88.9MB
</pre></div>


<h3 id="3-docker-image_1">3. Docker Imageのアップロード<a class="headerlink" href="#3-docker-image_1" title="Permanent link">&para;</a></h3>
<p>Docker Image のアップロードを行います。  </p>
<div class="codehilite"><pre><span></span>$ docker push &lt;USER NAME&gt;/hello
The push refers to repository [docker.io/&lt;USER NAME&gt;/hello]
b57c79f4a9f3: Mounted from library/ubuntu
d60e01b37e74: Mounted from library/ubuntu
e45cfbc98a50: Mounted from library/ubuntu
762d8e1a6054: Mounted from library/ubuntu
latest: digest: sha256:99aab145aaa0bf0e51a2ab995e0051b1756e1016cbc7d82bcee663c79f56b5c3 size: 1150
</pre></div>


<h3 id="4-docker-hub">4. Docker Hub の確認<a class="headerlink" href="#4-docker-hub" title="Permanent link">&para;</a></h3>
<p><img alt="Docker Hub" src="../imgs/docker-hub.png" /></p>
<p><a href="https://hub.docker.com/">https://hub.docker.com/</a> へアクセスし、 <code>&lt;USER NAME&gt;/hello</code> がアップロードされているか確認しましょう。</p>
<h3 id="5-docker-hub-docker-image">5. Docker Hub にアップロードしたDocker Imageの実行<a class="headerlink" href="#5-docker-hub-docker-image" title="Permanent link">&para;</a></h3>
<p>まずは現在存在するローカルのイメージを削除します。<br />
同名のイメージが存在するとDockerHubから取得せず、ローカルに存在するイメージを参照してしまうからです。</p>
<p>実行中のコンテナを削除</p>
<div class="codehilite"><pre><span></span>$ docker container ls -a
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                      PORTS               NAMES
429c028bcf74        ubuntu              &quot;echo hoge&quot;         16 seconds ago      Exited (0) 15 seconds ago                       stoic_greider
$ docker container prune
WARNING! This will remove all stopped containers.
Are you sure you want to continue? [y/N] y
Deleted
</pre></div>


<p>ローカルのImageを削除</p>
<div class="codehilite"><pre><span></span>$ docker image prune -a
WARNING! This will remove all images without at least one container associated to them.
Are you sure you want to continue? [y/N] y
Deleted Images:
</pre></div>


<div class="codehilite"><pre><span></span>$ docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
$ 
</pre></div>


<p>Docker Hub から作成したイメージの取得  </p>
<div class="codehilite"><pre><span></span>$ docker pull &lt;USER NAME&gt;/hello
Using default tag: latest
latest: Pulling from &lt;USER NAME&gt;/hello
898c46f3b1a1: Pull complete
63366dfa0a50: Pull complete
041d4cd74a92: Pull complete
6e1bee0f8701: Pull complete
Digest: sha256:99aab145aaa0bf0e51a2ab995e0051b1756e1016cbc7d82bcee663c79f56b5c3
Status: Downloaded newer image for &lt;USER NAME&gt;/hello:latest
</pre></div>


<p>Dockerイメージの実行</p>
<div class="codehilite"><pre><span></span>$ docker run &lt;USER NAME&gt;/hello
hello docker !
</pre></div>


<h2 id="dsl">DSL<a class="headerlink" href="#dsl" title="Permanent link">&para;</a></h2>
<h3 id="_1">コマンド<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h3>
<p>Dockerfileには17のコマンドが用意されています。</p>
<p><code>FROM</code> , <code>ENV</code> , <code>WORKDIR</code> , <code>RUN</code> , <code>ADD</code> , <code>ARGS</code> , <code>CMD</code> , <code>ONBUILD</code> , <code>LABEL</code> , <code>ENTRYPOINT</code> ,<br />
<code>STOPSIGNAL</code> , <code>MAINTAINER</code> , <code>VOLUME</code> , <code>HEALTHCHECK</code> , <code>EXPOSE</code> , <code>USER</code> , <code>SHELL</code></p>
<div class="admonition danger">
<p class="admonition-title">MAINTAINERコマンド</p>
<p><code>MAINTAINER</code> コマンドは非推奨です。<br />
このコマンドが使用されているDockerfileは既に古くなっている可能性があるので注意しましょう。</p>
</div>
<h3 id="_2">基本的なコマンド<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<p>個人的に、Dockerfileを本番のワークロードで使用する場合以下の7つのコマンドを覚えるだけで十分だと考えています。  </p>
<p><code>FROM</code> , <code>COPY</code> , <code>RUN</code> , <code>CMD</code> , <code>WORKDIR</code> , <code>ENV</code> , <code>USER</code></p>
<p>Node.jsを動かす際のサンプルを用意したので、サンプルのDockerfileをもとに見ていきましょう。<br />
実際のコードは以下を参照してください。<br />
<a href="https://github.com/y-ohgi/introduction-docker/tree/master/handson/dockerfile">introduction-docker/handson/dockerfile at master · y-ohgi/introduction-docker</a></p>
<div class="codehilite"><pre><span></span><span class="k">FROM</span><span class="s"> node</span>

<span class="k">ENV</span> <span class="nv">NODE_ENV</span><span class="o">=</span>production

<span class="k">WORKDIR</span><span class="s"> /scripts</span>

<span class="k">COPY</span> . .

<span class="k">RUN</span> npm install <span class="se">\</span>
 <span class="o">&amp;&amp;</span> groupadd app <span class="se">\</span>
 <span class="o">&amp;&amp;</span> useradd -g app -m app <span class="se">\</span>
 <span class="o">&amp;&amp;</span> mv /root/.config /home/app/ <span class="se">\</span>
 <span class="o">&amp;&amp;</span> chown -R app:app /scripts /home/app/.config

<span class="k">USER</span><span class="s"> app</span>

<span class="k">CMD</span> <span class="p">[</span><span class="s2">&quot;npm&quot;</span><span class="p">,</span> <span class="s2">&quot;start&quot;</span><span class="p">]</span>
</pre></div>


<h4 id="from">FROM<a class="headerlink" href="#from" title="Permanent link">&para;</a></h4>
<p>ベースとなるDocker Image を指定します。<br />
DockerはベースとなるDocker Image の上に <code>COPY</code> や <code>RUN</code> のようなコマンドを重ねてDocker Image を作成します。<br />
ベースとなるDocker Image は公式で提供されているImageを使用するのが一般的です。  </p>
<p>また、ここで設定したイメージを「ベースイメージ」と呼びます。</p>
<div class="codehilite"><pre><span></span>FROM node
</pre></div>


<h4 id="env">ENV<a class="headerlink" href="#env" title="Permanent link">&para;</a></h4>
<p>Docker内で使用する環境変数を定義します。<br />
<code>NODE_ENV</code> のようなDockerの起動時にデフォルトで定義されていてほしい環境変数を定義すると良いでしょう。</p>
<div class="codehilite"><pre><span></span>ENV NODE_ENV=production
</pre></div>


<h3 id="workdir">WORKDIR<a class="headerlink" href="#workdir" title="Permanent link">&para;</a></h3>
<p>Dockerfileでコマンドを実行する際に基準となるディレクトリを設定します。<br />
このとき存在しないディレクトリを指定すると自動的にディレクトリが作成されます。<br />
デフォルトだと <code>/</code> が設定されているため、最悪の場合既存のディレクトリを上書きしてしまいコンテナが起動しなくなります。</p>
<div class="codehilite"><pre><span></span>WORKDIR /scripts
</pre></div>


<h4 id="copy">COPY<a class="headerlink" href="#copy" title="Permanent link">&para;</a></h4>
<p>Docker内へホストのファイル/ディレクトリをコピーします。<br />
<code>COPY</code> は基本的に2つの引数を設定します。1つ目はホスト側のディレクトリ、2つ目はDocker側のディレクトリです。<br />
ホスト側のディレクトリは <code>docker build .</code> で指定したディレクトリです。この場合 <code>.</code> を指定しており、カレントディレクトリが参照されます。<br />
Docker側は <code>WORKDIR</code> で定義されたディレクトリを参照します。</p>
<div class="codehilite"><pre><span></span>COPY . .
</pre></div>


<h4 id="run">RUN<a class="headerlink" href="#run" title="Permanent link">&para;</a></h4>
<p>Docker内でコマンドを実行します。<br />
ここでコンテナへ依存するライブラリやパッケージのインストールやユーザーの設定などの処理を実行します。  </p>
<div class="codehilite"><pre><span></span>RUN npm install \
  &amp;&amp; groupadd app \
  &amp;&amp; useradd -g app app \
  &amp;&amp; chown -R app:app /scripts
</pre></div>


<h4 id="user">USER<a class="headerlink" href="#user" title="Permanent link">&para;</a></h4>
<p>作成したDocker Image を起動時にログインするユーザーを指定します。<br />
デフォルトは <code>root</code> が設定されているため、セキュリティリスクを回避するために別のユーザーを指定するのが良いでしょう。</p>
<div class="codehilite"><pre><span></span>USER app
</pre></div>


<h4 id="cmd">CMD<a class="headerlink" href="#cmd" title="Permanent link">&para;</a></h4>
<p>Docker起動時にデフォルトで実行されるコマンドを定義します。<br />
Dockerはここで設定したコマンドがフォアグラウンドで実行されている間が生存期間になります。<br />
そのため、プロセスの処理が走っている間はフォアグラウンドで実行するように記述します(バックグラウンドで起動するとDockerが終了してしまう)。</p>
<div class="codehilite"><pre><span></span>CMD [&quot;npm&quot;, &quot;run&quot;, &quot;start&quot;]
</pre></div>


<h3 id="_3">よく使用されるコマンド<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p>プロダクションで使用することは少ないと思いますが、その他の頻出するコマンドを紹介します。<br />
覚えておくと他の人のDockerfileを読む際に役立つでしょう。</p>
<h4 id="expose">EXPOSE<a class="headerlink" href="#expose" title="Permanent link">&para;</a></h4>
<p>コンテナ起動時に公開することを想定されているポートを記述します。<br />
<code>EXPOSE</code> を記載することで他の人から「このDockerはポートをどの使用するのか」がわかりやすくなるため、記述すると丁寧でしょう。  </p>
<div class="codehilite"><pre><span></span>EXPOSE 3000
</pre></div>


<p>コンテナ起動時に <code>EXPOSE</code> で指定されたポートをホスト側へ公開するには <code>-P</code> オプションを使用する必要があります。  </p>
<div class="codehilite"><pre><span></span>$ docker run -P nginx
</pre></div>


<h4 id="volume">VOLUME<a class="headerlink" href="#volume" title="Permanent link">&para;</a></h4>
<p>Data Volumeを作成するためのコマンドです。Volumeについては後の章で説明します。<br />
永続的なデータや共有するためのデータ、更新頻度の激しいファイルを扱うために使用されます。<br />
基本的に永続的なデータはDockerで管理することは推奨されないため、基本的にログのような更新頻度の激しいファイルで使用すると良いでしょう。</p>
<div class="codehilite"><pre><span></span>VOLUME [&quot;/app/log&quot;]
</pre></div>


<h4 id="args">ARGS<a class="headerlink" href="#args" title="Permanent link">&para;</a></h4>
<p>Dockerfileのビルド時に変数を使用するためのコマンドです。<br />
ビルドの前提条件/必要情報が増えると複雑化につながるため、基本的に使用しない方が良いです。</p>
<div class="codehilite"><pre><span></span>ARGS ${node_env:-production}
ENV node_env
</pre></div>


<div class="codehilite"><pre><span></span>$ docker build --build-arg node_env=development .
</pre></div>


<h4 id="add">ADD<a class="headerlink" href="#add" title="Permanent link">&para;</a></h4>
<p><code>COPY</code> コマンドを拡張したコマンドです。<br />
主に以下の3つの機能を持ちます。</p>
<ol>
<li><code>COPY</code> と同じく指定したパスをコンテナ内へコピー</li>
<li>URLを指定した場合、そのURLからファイルをダウンロードし、コンテナ内へコピー</li>
<li>コピーされたパスが <code>.tar</code> もしくは <code>.tar.gz</code> の場合解凍する</li>
</ol>
<div class="admonition note">
<p class="admonition-title">ADD vs COPY</p>
<p>基本的に <code>ADD</code> を使うのは避け、 <code>COPY</code> を使うのが良いでしょう。<br />
<code>ADD</code> は「指定したファイルのコピー」・「指定したURLの取得 」・「圧縮されたファイルの解凍」と非常に高機能な反面、Dockerfileが複雑度が増します。<br />
また、URLからファイルを取得するのはパブリックへ依存が発生し、URLの参照先が変更された際にビルド不可なDockerfileができてしまいます。<br />
<code>COPY</code> の場合機能がシンプルなのでシンプルなDockerfileの作成に繋がります。</p>
</div>
<h4 id="entrypoint">ENTRYPOINT<a class="headerlink" href="#entrypoint" title="Permanent link">&para;</a></h4>
<p>指定されたコマンドを実行します。<br />
CMDとは異なり、 <code>docker run</code> 時に指定したコマンドを <code>ENTRYPOINT</code> の引数として使用します。</p>
<div class="codehilite"><pre><span></span>ENTRYPOINT [&quot;echo&quot;]
</pre></div>


<p>引数に "hello" を渡すと <code>echo "hello"</code> が実行される</p>
<div class="codehilite"><pre><span></span>$ docker run &lt;IMAGE NAME&gt; &quot;hello!&quot;
hello!
</pre></div>


<p><code>entrypoint</code> は実行時のオプションで変更可能  </p>
<div class="codehilite"><pre><span></span>$ docker run --entrypoint date &lt;IMAGE NAME&gt;
Mon Mar 18 22:36:19 JST 2019
</pre></div>


<div class="admonition note">
<p class="admonition-title">ENTRYPOINT vs CMD</p>
<p>基本的に <code>CMD</code> を使うのが良いでしょう。<br />
<code>ENTRYPOINT</code> はDocker起動時のコマンドを強制します。<br />
コマンドのラップをするDocker Image の場合は <code>ENTRYPOINT</code> のほうが好ましいですが、一般的なWebアプリケーションの場合は <code>CMD</code> を使用する方がユーザーにとって使いやすいDocker Image になります。</p>
</div>
<h2 id="_4">まとめ<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<ul>
<li>Dockerfileを記述してDocker Image を作成する</li>
<li>Docker Image はDockerレジストリへアップロードすることで容易に保管/配布ができる</li>
<li>Dockerfileは基本的に7個のコマンドの組み合わせで作成できる</li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../image/" title="image" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  前
                </span>
                image
              </span>
            </div>
          </a>
        
        
          <a href="../container/" title="container" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  次
                </span>
                container
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.dc02f8ce.js"></script>
      
        
        
          
          <script src="../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
                <script src="../../assets/javascripts/lunr/tinyseg.js"></script>
              
              
                <script src="../../assets/javascripts/lunr/lunr.ja.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="../../assets/custom.js"></script>
      
    
  </body>
</html>